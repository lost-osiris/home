(function() {
  var Dom;

  Dom = require('./dom');

  module.exports = {
    init: function(state) {
      var self;
      self = this;
      this.themeSet = false;
      if (self.isLoaded('seti-syntax')) {
        atom.config.onDidChange('seti-syntax.themeColor', function(value) {
          return self.setTheme(value.newValue, value.oldValue, true);
        });
        atom.config.onDidChange('seti-syntax.dynamicColor', function(value) {
          var newColor;
          if (value.newValue) {
            newColor = atom.config.get('seti-ui.themeColor');
            return self.setTheme(newColor, false, true);
          } else {
            if (atom.config.get('seti-syntax.themeColor')) {
              newColor = atom.config.get('seti-syntax.themeColor');
            } else {
              newColor = 'default';
            }
            return self.setTheme(newColor, false, true);
          }
        });
        if (self.isLoaded('seti-ui')) {
          if (atom.config.get('seti-syntax.dynamicColor') && !this.themeSet) {
            self.setTheme(atom.config.get('seti-ui.themeColor'), false, false);
          }
          atom.config.onDidChange('seti-ui.themeColor', function(value) {
            if (atom.config.get('seti-syntax.dynamicColor')) {
              return self.setTheme(value.newValue, value.oldValue, false);
            }
          });
          self.onDeactivate('seti-ui', function() {
            if (atom.config.get('seti-syntax.dynamicColor')) {
              return self.setTheme('default', false, false);
            }
          });
        }
        if ((atom.config.get('seti-syntax.themeColor')) && !this.themeSet) {
          return self.setTheme(atom.config.get('seti-syntax.themeColor'), false, false);
        } else if (!this.themeSet) {
          return self.setTheme('default', false, false);
        }
      }
    },
    isLoaded: function(which) {
      return atom.packages.isPackageLoaded(which);
    },
    onActivate: function(which, cb) {
      return atom.packages.onDidActivatePackage(function(pkg) {
        if (pkg.name === which) {
          return cb(pkg);
        }
      });
    },
    onDeactivate: function(which, cb) {
      return atom.packages.onDidDeactivatePackage(function(pkg) {
        if (pkg.name === which) {
          return cb(pkg);
        }
      });
    },
    "package": atom.packages.getLoadedPackage('seti-syntax'),
    packageInfo: function(which) {
      return atom.packages.getLoadedPackage(which);
    },
    refresh: function() {
      var self;
      self = this;
      self["package"].deactivate();
      return setImmediate(function() {
        return self["package"].activate();
      });
    },
    setTheme: function(theme, previous, reload) {
      var fs, pkg, self, themeData;
      self = this;
      fs = require('fs');
      pkg = this["package"];
      themeData = '@import "themes/' + theme.toLowerCase() + '";';
      this.themeSet = true;
      return fs.readFile(pkg.path + '/styles/user-theme.less', 'utf8', function(err, fileData) {
        if (fileData !== themeData) {
          return fs.writeFile(pkg.path + '/styles/user-theme.less', themeData, function(err) {
            if (!err) {
              return self.refresh();
            }
          });
        }
      });
    }
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL2hvbWUvbW93ZW5zLy5hdG9tL3BhY2thZ2VzL3NldGktc3ludGF4L2xpYi9zZXR0aW5ncy5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQSxNQUFBOztFQUFBLEdBQUEsR0FBTSxPQUFBLENBQVEsT0FBUjs7RUFFTixNQUFNLENBQUMsT0FBUCxHQUNFO0lBQUEsSUFBQSxFQUFNLFNBQUMsS0FBRDtBQUVKLFVBQUE7TUFBQSxJQUFBLEdBQU87TUFDUCxJQUFDLENBQUEsUUFBRCxHQUFZO01BR1osSUFBRyxJQUFJLENBQUMsUUFBTCxDQUFjLGFBQWQsQ0FBSDtRQUdFLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBWixDQUF3Qix3QkFBeEIsRUFBa0QsU0FBQyxLQUFEO2lCQUNoRCxJQUFJLENBQUMsUUFBTCxDQUFjLEtBQUssQ0FBQyxRQUFwQixFQUE4QixLQUFLLENBQUMsUUFBcEMsRUFBOEMsSUFBOUM7UUFEZ0QsQ0FBbEQ7UUFJQSxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVosQ0FBd0IsMEJBQXhCLEVBQW9ELFNBQUMsS0FBRDtBQUVsRCxjQUFBO1VBQUEsSUFBSSxLQUFLLENBQUMsUUFBVjtZQUNFLFFBQUEsR0FBVyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQVosQ0FBZ0Isb0JBQWhCO21CQUNYLElBQUksQ0FBQyxRQUFMLENBQWMsUUFBZCxFQUF3QixLQUF4QixFQUErQixJQUEvQixFQUZGO1dBQUEsTUFBQTtZQU1FLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFaLENBQWdCLHdCQUFoQixDQUFKO2NBQ0UsUUFBQSxHQUFXLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBWixDQUFnQix3QkFBaEIsRUFEYjthQUFBLE1BQUE7Y0FJRSxRQUFBLEdBQVcsVUFKYjs7bUJBS0EsSUFBSSxDQUFDLFFBQUwsQ0FBYyxRQUFkLEVBQXdCLEtBQXhCLEVBQStCLElBQS9CLEVBWEY7O1FBRmtELENB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QUFZLGtCQUFBLEdBQXFCLEtBQUssQ0FBQyxXQUFOLENBQUEsQ0FBckIsR0FBMkM7TUFHdkQsSUFBQyxDQUFBLFFBQUQsR0FBWTthQUdaLEVBQUUsQ0FBQyxRQUFILENBQVksR0FBRyxDQUFDLElBQUosR0FBVyx5QkFBdkIsRUFBa0QsTUFBbEQsRUFBMEQsU0FBQyxHQUFELEVBQU0sUUFBTjtRQUV4RCxJQUFHLFFBQUEsS0FBWSxTQUFmO2lCQUVFLEVBQUUsQ0FBQyxTQUFILENBQWEsR0FBRyxDQUFDLElBQUosR0FBVyx5QkFBeEIsRUFBbUQsU0FBbkQsRUFBOEQsU0FBQyxHQUFEO1lBRTVELElBQUcsQ0FBQyxHQUFKO3FCQUVFLElBQUksQ0FBQyxPQUFMLENBQUEsRUFGRjs7VUFGNEQsQ0FBOUQsRUFGRjs7TUFGd0QsQ0FBMUQ7SUFWUSxDQXhGVjs7QUFIRiIsInNvdXJjZXNDb250ZW50IjpbIkRvbSA9IHJlcXVpcmUoJy4vZG9tJylcblxubW9kdWxlLmV4cG9ydHMgPVxuICBpbml0OiAoc3RhdGUpIC0+XG5cbiAgICBzZWxmID0gQFxuICAgIEB0aGVtZVNldCA9IGZhbHNlXG5cbiAgICAjIE9OQ0UgUEFDS0FHRSBJUyBMT0FERURcbiAgICBpZiBzZWxmLmlzTG9hZGVkKCdzZXRpLXN5bnRheCcpXG5cbiAgICAgICMgV0hFTiBTWU5UQVggVEhFTUUgQ0hBTkdFU1xuICAgICAgYXRvbS5jb25maWcub25EaWRDaGFuZ2UgJ3NldGktc3ludGF4LnRoZW1lQ29sb3InLCAodmFsdWUpIC0+XG4gICAgICAgIHNlbGYuc2V0VGhlbWUgdmFsdWUubmV3VmFsdWUsIHZhbHVlLm9sZFZhbHVlLCB0cnVlXG5cbiAgICAgICMgV0hFTiBEWU5BTUlDIFRIRU1FIElTIEVOQUJMRUQgT1IgRElTQUJMRURcbiAgICAgIGF0b20uY29uZmlnLm9uRGlkQ2hhbmdlICdzZXRpLXN5bnRheC5keW5hbWljQ29sb3InLCAodmFsdWUpIC0+XG4gICAgICAgICMgSUYgRFlOSU1JQyBJUyBBTExXT0VEXG4gICAgICAgIGlmICh2YWx1ZS5uZXdWYWx1ZSlcbiAgICAgICAgICBuZXdDb2xvciA9IGF0b20uY29uZmlnLmdldCgnc2V0aS11aS50aGVtZUNvbG9yJylcbiAgICAgICAgICBzZWxmLnNldFRoZW1lIG5ld0NvbG9yLCBmYWxzZSwgdHJ1ZVxuICAgICAgICAjIElGIERZTkFNSUMgSVMgTk9UIEFMTE9XRURcbiAgICAgICAgZWxzZVxuICAgICAgICAgICMgSUYgU1lOVEFYIENPTE9SIEhBUyBCRUVOIFNFVFxuICAgICAgICAgIGlmIChhdG9tLmNvbmZpZy5nZXQoJ3NldGktc3ludGF4LnRoZW1lQ29sb3InKSlcbiAgICAgICAgICAgIG5ld0NvbG9yID0gYXRvbS5jb25maWcuZ2V0KCdzZXRpLXN5bnRheC50aGVtZUNvbG9yJylcbiAgICAgICAgICAjIEZBTExCQUNLIFRQIERFRkFVTFQgQ09MTyBJRiBOT05FIFNFVFxuICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgIG5ld0NvbG9yID0gJ2RlZmF1bHQnXG4gICAgICAgICAgc2VsZi5zZXRUaGVtZSBuZXdDb2xvciwgZmFsc2UsIHRydWVcblxuICAgICAgIyBJRiBTRVRJIFVJIElTIExPQURFRFxuICAgICAgaWYgc2VsZi5pc0xvYWRlZCgnc2V0aS11aScpXG5cbiAgICAgICAgIyBJRiBEWU5BTUlDIFRIRU0gSVMgQUxMT1dFRFxuICAgICAgICBpZiBhdG9tLmNvbmZpZy5nZXQoJ3NldGktc3ludGF4LmR5bmFtaWNDb2xvcicpIGFuZCBub3QgQHRoZW1lU2V0XG4gICAgICAgICAgIyBTRVQgU1lOVEFYIFRIRU1FIFRPIE1BVENIIFVJXG4gICAgICAgICAgc2VsZi5zZXRUaGVtZSBhdG9tLmNvbmZpZy5nZXQoJ3NldGktdWkudGhlbWVDb2xvcicpLCBmYWxzZSwgZmFsc2VcblxuICAgICAgICAjIFdIRU4gVUkgVEhFTUUgQ0hBTkdFU1xuICAgICAgICBhdG9tLmNvbmZpZy5vbkRpZENoYW5nZSAnc2V0aS11aS50aGVtZUNvbG9yJywgKHZhbHVlKSAtPlxuICAgICAgICAgICMgSUYgRFlOQU1JQyBUSEVNIElTIEFMTE9XRURcbiAgICAgICAgICBpZiBhdG9tLmNvbmZpZy5nZXQoJ3NldGktc3ludGF4LmR5bmFtaWNDb2xvcicpXG4gICAgICAgICAgICAjIFNFVCBTWU5UQVggVEhFTUUgVE8gTUFUQ0ggVUlcbiAgICAgICAgICAgIHNlbGYuc2V0VGhlbWUgdmFsdWUubmV3VmFsdWUsIHZhbHVlLm9sZFZhbHVlLCBmYWxzZVxuXG4gICAgICAgICMgSUYgU0VUSSBVSSBJUyBERUFDVElWQVRFRFxuICAgICAgICBzZWxmLm9uRGVhY3RpdmF0ZSAnc2V0aS11aScsIC0+XG4gICAgICAgICAgIyBJRiBEWU5BTUlDIFRIRU0gV0FTIEFMTE9XRURcbiAgICAgICAgICBpZiBhdG9tLmNvbmZpZy5nZXQoJ3NldGktc3ludGF4LmR5bmFtaWNDb2xvcicpXG4gICAgICAgICAgICAjIFNFVCBUSEVNRSBUTyBERUZBVUxUXG4gICAgICAgICAgICBzZWxmLnNldFRoZW1lICdkZWZhdWx0JywgZmFsc2UsIGZhbHNlXG5cbiAgICAgICMgU0VUIFVTRVIgVEhFTUUgSVMgTk9UIFNFVCBEWU5BTUlDQUxMWVxuICAgICAgaWYgKGF0b20uY29uZmlnLmdldCgnc2V0aS1zeW50YXgudGhlbWVDb2xvcicpKSBhbmQgbm90IEB0aGVtZVNldFxuICAgICAgICBzZWxmLnNldFRoZW1lIGF0b20uY29uZmlnLmdldCgnc2V0aS1zeW50YXgudGhlbWVDb2xvcicpLCBmYWxzZSwgZmFsc2VcblxuICAgICAgIyBJRiBBTEwgRUxTRSBIQVMgRkFJTEVELCBMT0FEIFRIRSBERUZBVUxUIFRIRU1FXG4gICAgICBlbHNlIGlmIChub3QgQHRoZW1lU2V0KVxuICAgICAgICBzZWxmLnNldFRoZW1lICdkZWZhdWx0JywgZmFsc2UsIGZhbHNlXG5cbiAgIyBDSEVDS1MgSUYgQSBQQUNLQUdFIElTIExPQURFRFxuICBpc0xvYWRlZDogKHdoaWNoKSAtPlxuICAgIHJldHVybiBhdG9tLnBhY2thZ2VzLmlzUGFja2FnZUxvYWRlZCh3aGljaClcblxuICAjIFdIRU4gUEFDS0FHRSBBQ1RJVkFURVNcbiAgb25BY3RpdmF0ZTogKHdoaWNoLCBjYikgLT5cbiAgICBhdG9tLnBhY2thZ2VzLm9uRGlkQWN0aXZhdGVQYWNrYWdlIChwa2cpIC0+XG4gICAgICBpZiBwa2cubmFtZSA9PSB3aGljaFxuICAgICAgICBjYiBwa2dcblxuICAjIFdIRU4gUEFDS0FHRSBERUFDVElWQVRFU1xuICBvbkRlYWN0aXZhdGU6ICh3aGljaCwgY2IpIC0+XG4gICAgYXRvbS5wYWNrYWdlcy5vbkRpZERlYWN0aXZhdGVQYWNrYWdlIChwa2cpIC0+XG4gICAgICBpZiBwa2cubmFtZSA9PSB3aGljaFxuICAgICAgICBjYiBwa2dcblxuICAjIEdFVCBJTkZPIEFCT1VUIE9VUiBQQUNLQUdFXG4gIHBhY2thZ2U6IGF0b20ucGFja2FnZXMuZ2V0TG9hZGVkUGFja2FnZSgnc2V0aS1zeW50YXgnKVxuXG4gICMgREVURVJNSU5FIElGIEEgU1BFQ0lGSUMgUEFDS0FHRSBIQVMgQkVFTiBMT0FERURcbiAgcGFja2FnZUluZm86ICh3aGljaCkgLT5cbiAgICByZXR1cm4gYXRvbS5wYWNrYWdlcy5nZXRMb2FkZWRQYWNrYWdlIHdoaWNoXG5cbiAgIyBSRUxPQUQgV0hFTiBTRVRUSU5HUyBDSEFOR0VcbiAgcmVmcmVzaDogLT5cbiAgICBzZWxmID0gQFxuICAgIHNlbGYucGFja2FnZS5kZWFjdGl2YXRlKClcbiAgICBzZXRJbW1lZGlhdGUgLT5cbiAgICAgIHJldHVybiBzZWxmLnBhY2thZ2UuYWN0aXZhdGUoKVxuXG4gIHNldFRoZW1lOiAodGhlbWUsIHByZXZpb3VzLCByZWxvYWQpIC0+XG4gICAgc2VsZiA9IEBcbiAgICBmcyA9IHJlcXVpcmUoJ2ZzJylcbiAgICBwa2cgPSBAcGFja2FnZVxuICAgIHRoZW1lRGF0YSA9ICdAaW1wb3J0IFwidGhlbWVzLycgKyB0aGVtZS50b0xvd2VyQ2FzZSgpICsgJ1wiOydcblxuICAgICMgVEhJUyBQUkVWRU5UUyBUSEVNRSBGUk9NIEJFSU5HIFNFVCBUV0lDRVxuICAgIEB0aGVtZVNldCA9IHRydWVcblxuICAgICMgQ0hFQ0sgQ1VSUkVOVCBUSEVNRSBGSUxFXG4gICAgZnMucmVhZEZpbGUgcGtnLnBhdGggKyAnL3N0eWxlcy91c2VyLXRoZW1lLmxlc3MnLCAndXRmOCcsIChlcnIsIGZpbGVEYXRhKSAtPlxuICAgICAgIyBJRiBUSEVNRSBJUyBESUZGRVJFTlQgVEhBTiBJUyBVU0VEIFRPIEJFXG4gICAgICBpZiBmaWxlRGF0YSAhPSB0aGVtZURhdGFcbiAgICAgICAgIyBTQVZFIEEgTkVXIFVTRVIgVEhFTUUgRklMRVxuICAgICAgICBmcy53cml0ZUZpbGUgcGtnLnBhdGggKyAnL3N0eWxlcy91c2VyLXRoZW1lLmxlc3MnLCB0aGVtZURhdGEsIChlcnIpIC0+XG4gICAgICAgICAgIyBJRiBGSUxFIFdBUyBXUklUVEVOIE9LXG4gICAgICAgICAgaWYgIWVyclxuICAgICAgICAgICAgIyBSRUxPQUQgVEhFIFZJRVdcbiAgICAgICAgICAgIHNlbGYucmVmcmVzaCgpXG4iXX0=
